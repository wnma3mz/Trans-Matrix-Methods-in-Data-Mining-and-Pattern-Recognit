第十二章

网页搜索引擎的网页排名

当使用搜索引擎在互联网上进行搜索时，首先有一个传统的文本处理部分，其目的是查找包含查询词的所有网页。由于网络规模巨大，点击量可能太大，无法使用。因此，需要一些质量度量来过滤掉那些不那么有趣的页面。

当使用Web搜索引擎时，搜索短语通常是未指定的。

例12.1。2005年9月29日，谷歌使用“大学”这一搜索词组进行了一次搜索，结果链接到以下知名大学：哈佛大学、斯坦福大学、剑桥大学、耶鲁大学、康奈尔大学、牛津大学。与搜索短语相关的网页总数超过20亿。

显然，谷歌使用了一种算法来对所有网页进行排名，这种算法相当符合常识性的质量标准。有点令人惊讶的是，排名过程不是基于人类的判断，而是基于网络的链接结构。不严格地说，如果一个网页有来自其他高排名网页的链接，谷歌会给它分配一个高排名。我们将看到这个自引用语句可以用数学公式表示为某个矩阵的特征值方程。

12.1页面排名

当然，要定义一个对搜索引擎的所有用户都可以接受的普遍有效的相关性度量是不可能的。谷歌使用pagerank的概念作为网页质量的衡量标准。它基于这样一个假设，即一个页面的链接数量提供了关于页面重要性的信息。我们将主要基于[74]和[33]对pagerank进行描述。关于谷歌，请参见[19]。

一百四十七

让所有网页从1到n排序，让我成为一个特定的网页。然后oi将表示我链接到的一组页面，即大纲。大纲的数量表示为ni= oi。inlink的集合（表示为i i）是大纲为i的页面。

​                     







​        

​        



​        

​        



​        

​        



​        

​        







​        



​        



​        



​        

​        

​        





​                                               





一般来说，我可以认为一个页面越重要，它的链接越多。然而，仅基于链接数量的排名系统很容易操作：当您设计一个网页时（例如，出于商业原因），您希望被尽可能多的用户看到，您可以简单地创建大量（无信息和不重要）页面，这些页面具有u链接到i。为了阻止这种情况，我们定义了i的等级，这样，如果一个高等级的页面j有一个大纲，这就增加了i的重要性，如下所示：页面i的等级是大纲到i的页面等级的加权和。权重是这样的，即第J页在其大纲中平均划分。把这个转化成数学，我们得到

（12.1）

这个初步定义是递归的，因此不能直接计算pageranks。相反，可以使用定点迭代。猜测一个初始排名向量r0。然后迭代

（12.2）

这种迭代有一些问题：如果一个页面没有大纲，那么在迭代过程中，它只通过其inlink累积排名，但是这个排名永远不会进一步分布。因此，不清楚迭代是否收敛。我们稍后再讨论这个问题。

如果我们将（12.1）重新表述为表示互联网图形的矩阵的特征值问题，将获得更多的见解。设q为n维的平方矩阵。定义

qij=1美元/nj，如果有从j到i的链接，则为0。

12.1.页面排名

这意味着第i行在与i的inlink对应的位置上有非零元素。同样，第j列在与j的outlines对应的位置上也有非零元素等于nj，并且，如果页面有outlines，第j列中所有元素的和等于1。在矩阵q的以下符号图中，非零元素表示为：

J

链接

大纲

例12.2。下面的链接图说明了一组带有大纲和inlink的网页：

​                     



​        





​        



​        



​        



​        



​        



​        



​        



​        



​        



​        





​        



​        



​        



​        











相应的矩阵变成

.

由于第4页没有大纲，相应的列等于零。

显然，定义（12.1）等价于第一行的标量积和向量r，后者拥有所有页面的排名。我们可以用矩阵形式写出方程，

λr=qr，λ=1，（12.3），即r是特征值为λ=1的q的特征向量。现在很容易看出迭代（12.2）等于

r（k+1）=qr（k），k=0,1，…，

这是计算特征向量的幂次方法。然而，目前还不清楚pagerank是否定义得很好，因为我们不知道是否存在一个等于1的特征值。结果表明，马尔可夫链理论在

分析。

12.2随机行走和马尔可夫链

对pagerank概念有一个随机的遍历解释。假设一个浏览网页的浏览者在相同概率的大纲中选择下一个网页。然后，随机游动产生一个马尔可夫链（参见，例如[70]）。马尔可夫链是一个随机过程，其中下一个状态完全由当前状态决定；该过程没有内存。马尔可夫链的转移矩阵是qt。（注意，我们使用的符号与随机过程理论中常见的符号稍有不同。）

随机冲浪者不应该被卡住。换句话说，我们的随机行走模型应该没有没有没有大纲的页面。（这样一个页面对应于q中的零列），因此模型被修改，以便在所有位置用一个常量值替换零列。这意味着进入任何其他互联网页面的概率是相等的。定义向量

如果nj=0，dj=1，

否则为0，

对于j=1，…，n和

（12.4）

定义了修改后的矩阵

（12.5）

通过这种修改，矩阵p是一个合适的列随机矩阵：它有非负元素，每列元素的总和为1。前面的陈述可以重新表述如下。

12.2.随机游动和马尔可夫链

提案12.3.一列随机矩阵p满足

ETP=ET（12.6）

其中e由（12.4）定义。

例12.4.上一个示例中的矩阵修改为

.

与（12.3）类似，我们将pagerank向量定义为特征值为1的p的唯一特征向量，

pr=r。

过渡矩阵的特征向量对应于马尔可夫链的平稳概率分布。位置i，ri中的元素是经过大量步骤后，随机步行者在网页i上的概率。但是，特征值为1的唯一特征值的存在仍然没有保证。为了确保唯一性，矩阵必须是不可约的；参见[53]。

定义12.5.如果存在置换矩阵p，则称为可约矩阵a。

，（12.7）

其中x和z都是正方形。否则，矩阵称为不可约矩阵。

例12.6。为了说明可约性的概念，我们给出了一个对应于可约矩阵的链接图的例子：

​                     



​        



​        



​        



​        



​        



​        



​        



​        



​        



​        



​        



​        





​        



​        











一个进入链接图左侧的随机步行者永远不会离开它，同样也会被困在右侧。对应的矩阵是

，（12.8）

其形式为（12.7）。实际上，这个矩阵有两个特征值等于1，一个等于−1；参见示例12.10。

对应于不可约矩阵的有向图是强连通的：在图中任意两个节点（ni，nj），都存在一条从ni到nj的路径。

不可约正矩阵的最大特征值的唯一性是由佩伦-弗罗贝尼乌斯定理所保证的；我们在这里讨论的特殊情况下说明它。不等式a>0被理解为a的所有元素都是严格正的。用显性特征值表示最大的特征值，即λ1。

定理12.7。设A为不可约列随机矩阵。主特征值λ1等于1。有一个唯一的对应特征向量r满足r>0；这是唯一非负的特征向量。如果a>0，则i<1，i=2,3，…，n。

证据。因为a是列随机的，所以我们有eta=et，这意味着1是a的特征值。其余的陈述可以用Perron-Frobenius理论证明[70，第8章]。

考虑到互联网的规模，我们可以确定链接矩阵p是可约化的，这意味着p的pagerank特征向量没有很好的定义。为了确保不可约性，也就是说，为了使随机步行者不可能被困在子图中，人们人为地添加了从每个网页到所有其他网页的链接。在矩阵项中，这可以通过取p和秩1矩阵的凸组合来实现。

，（12.9）

某些α满足0≤α≤1。很容易看出矩阵A是列随机的：

.

12.2.随机游动和马尔可夫链

附加排名1项的随机行走解释是，在每个时间步中，浏览页面的冲浪者将跳到概率为1−α的随机页面（有时称为远程传输）。

我们现在看到矩阵A的pagerank向量定义得很好。

提案12.8.（12.9）中定义的柱随机矩阵a是不可约的（因为a>0），并且具有显性特征值λ1=1。相应的特征向量r满足r>0。

对于数值特征值算法的收敛性，必须知道P的特征值是如何被秩1修正（12.9）所改变的。

定理12.9.假设柱随机矩阵p的特征值为1，λ2，λ3…，λn。那么a=αp+（1-α）n1 eet的特征值为1，αλ2，αλ3，…，αλn。

证据。将_e定义为e归一化为欧几里得长度1，并让u1∈rn×（n−1）是正交的。那么，既然_etp=e_t，

（12.10）

哪里。因为我们做了一个相似变换-

另外，矩阵t的特征值为λ2，λ3，…，λn。

.

因此，

   

现在声明立即生效。

定理12.9表明，即使p的多重特征值等于1（谷歌矩阵实际上就是这样），a值的第二大特征值始终等于α。

示例12.10。我们用（12.8）中的p和α=0.85计算矩阵的特征值和特征向量。matlab代码lp=eig（p）'；e=one（6,1）；

a=0.85*p+0.15/6*e*e'；

[r，l]=eig（a）得出以下结果：

lp=-0.5 1.0-0.5 1.0-1.0 0 0

R=0.447-0.365-0.354 0.000 0.817 0.101

0.430-0.365 0.354-0.000-0.408-0.752

0.430-0.365 0.354 0.000-0.408 0.651

0.057-0.000-0.707 0.000 0.000-0.000

0.469 0.548-0.000-0.707 0.000 0.000

0.456 0.548 0.354 0.707-0.000-0.000

诊断（L）=1.0 0 0.85-0.0-0.85-0.425-0.425

可以看出，第一个特征向量（对应于特征值1）是唯一的非负特征向量，如定理12.7所述。

而不是修改（12.9），我们可以定义

A=αp+（1−α）vet，

其中v是一个非负向量，其值为1，可以选择使搜索偏向于某些类型的网页。因此，它有时被称为个性化向量[74，48]。矢量V还可以用来避免被所谓的链路农场操纵[57，59]。

12.3 pagerank计算的幂法

我们要解决特征值问题

ar=r，

其中，r标准化=1。在本节中，我们用T1表示所寻求的特征向量。对于概率分布的随机矩阵和向量，自然使用向量的1-范数（第2.3节）。由于a的稀疏性和维数（几十亿阶），使用第15章中描述的密集矩阵的任何标准方法计算特征向量都是不可能的，因为这些方法是基于对矩阵应用正交变换。目前唯一可行的方法是幂法。

假设给出了初始近似值r（0）。下面的算法给出了幂法。

12.3.pagerank计算的幂法

​             

### ar=λr的幂法

​             

对于k=1,2，…直到收敛

   

​             

归一化向量（使其1-范数等于1）的目的是避免向量变得非常大或非常小，从而在浮点系统中不可呈现。稍后我们将看到，在pagerank计算中不需要规范化。在这种情况下，不需要计算特征值近似值，因为已知所寻求的特征值等于一。

功率法的收敛性取决于特征值的分布。为了使表示更简单，我们假设a是可对角化的，即存在特征向量的非奇异矩阵t，t−1at=diag（λ1，…，λn）。特征值λi的阶数为1=λ1>λ2≥·····≥λn。根据特征向量展开初始近似值r（0）。

r（0）=c1t1+c2t2+····+cntn，

其中，假设=0，r=T1是所寻求的特征向量。然后我们有了

.

显然，因为j=2,3，…我们有λj_<1，第二项趋于零，幂法收敛到特征向量r=T1。收敛速度由λ2确定。如果接近1，则迭代非常慢。幸运的是，谷歌矩阵并非如此；参见定理12.9及以下。

利用特征值问题的残差向量，给出了幂次迭代的停止准则。设λ_为特征值的计算近似值，_r为相应的近似特征向量。然后可以看出[94]，[4，p.229]最佳误差矩阵e，其中

（a+e）r_=λ_r，_

没错，满足

，

其中s=ar_−λ_r_。这意味着，如果残差很小，则计算出的近似特征向量_r是接近a的矩阵a+e的精确特征向量。因为在pagerank计算中，我们处理的是一个正矩阵，其所有列加起来都是一个，所以使用1-范数是很自然的。[55。因为1-范数和欧几里得范数是等价的（参见（2.6）），所以这没有什么区别。

在通常的幂法公式中，向量被归一化以避免下溢或溢出。我们现在证明，当矩阵是列随机的时候，这是不必要的。

提案12.11.假设向量z满足

矩阵A是列随机的。然后

（12.11）

证据。输入y=az。然后

   

因为a是随机列（eta=et）。

鉴于google矩阵的巨大维度，计算

矩阵向量积y=az，其中。回想一下，p是根据实际的链接矩阵q构造的

，

其中，行向量d在所有与没有大纲的网页相对应的位置都有元素1（见（12.5））。这意味着要形成p，我们要在q中插入大量的全向量，每个向量的维数都与总网页数相同。因此，我们负担不起显式存储p。让我们更详细地看一下乘法y=az：

（12.12）

哪里

β=αdtz+（1−α）etz。

我们不需要用这个方程来计算β。相反，我们可以将（12.11）与（12.12）结合使用：

   

因此，我们有。另外一个额外的好处是我们根本不使用向量d，也就是说，我们不需要知道哪些页面缺少大纲。

以下matlab代码实现矩阵向量乘法：

12.3.pagerank计算的幂法

yhat=alpha*q*z；beta=1-范数（yhat，1）；y=yhat+beta*v；residual=norm（y-z，1）；

这里v=（1/n）e，或者一个个性化的远程传送向量；参见第154页。为了节省内存，我们甚至应该避免使用额外的向量yhat并用y替换它。

根据定理12.9，我们知道google矩阵的第二特征值满足λ2=α。α的典型值为0.85。大约需要K=57次迭代，使系数0.85K等于10-4。据报道[57]接近谷歌使用的迭代次数。

   

X 10

图12.1.斯坦福.edu矩阵的20000×20000子矩阵。

例12.12。作为一个例子，我们使用了从stanford.edu域获得的矩阵p。页数为281903页，链接总数为2312497。矩阵的一部分如图12.1所示。我们计算了pagerank

   

图12.2.stanford.edu矩阵的幂迭代（top）和pagerank向量（bottom）中的余数。

向量使用功率法，α=0.85，迭代63次，直到残差的1-范数小于10-6。残差和最终pagerank向量如图12.2所示。

由于一个pagerank计算可能需要几天时间，因此已经提出了迭代过程的一些改进。在[53]中，描述了一种自适应方法，该方法检查pagerank向量组件的收敛性，并避免对这些组件执行幂迭代。据报道，加速率高达30%。在[54]中使用了Web的块结构，并且报告了系数2的加速。基于Aitken-Extrapo的加速方法-

12.4.点击量

相关描述见[55]。Langville和Meyer的几篇论文以及[51]中讨论了聚合方法。

当计算互联网子集的pagerank时，例如，一个特定的域，矩阵p可以是一个维度，对于该维度，可以使用除幂法以外的方法，例如阿诺迪方法；见[40]和第15.8.3节。甚至可以使用matlab函数eigs来计算少量的特征值和稀疏矩阵的相应特征向量，使用arnoldi方法重新启动。

在[44]中提出了pagerank的变体。pagerank矩阵的其他属性在[84]中给出。

12.4点击量

另一种基于Web链接结构的方法与pagerank[56]同时介绍。它被称为hits（超文本诱导的主题搜索），基于权限和中心的概念。权威是一个有许多链接的网页，而中心有许多大纲。基本思想是好的中心指向好的权威，好的权威指向好的中心。每个网页都被分配一个中心分数Y和一个权威分数X。

设l为有向网络图的邻接矩阵。然后给出两个方程式，根据基本思想，用数学方法定义两个分数之间的关系：

x=lty，y=lx.（12.13）

计算分数的算法是幂法，它收敛到L的最大奇异值对应的左右奇异向量，在hits的实现中，使用的邻接矩阵不是整个web的邻接矩阵，而是与查询相关的所有页面的邻接矩阵。

现在有大量关于pagerank、hits和其他排名方法的文献。有关概述，请参见[7、58、59]。在[65]中提出了点击率和pagerank的组合。

显然，pagerank和hits的基础思想不仅限于Web应用程序，而且可以应用于其他网络分析。最近，一项关于最高法院判例的研究中使用了hits方法的变体[36]。hits在[17]中被概括，它也处理同义词提取。在[72]中，genarnk（基于pagerank概念）被用于微阵列实验的分析。


 