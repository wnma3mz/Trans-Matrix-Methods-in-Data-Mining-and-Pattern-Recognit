第五章

QR分解

这本书的一个主要主题是通过正交变换将矩阵分解成紧凑的形式（例如三角形或对角线）。我们现在将介绍第一个这样的分解，qr分解，它是矩阵a在正交矩阵和三角形矩阵的乘积中的分解。这比计算LU分解更雄心勃勃，因为这两个因素都只需要是三角形的。

5.1正交变换为三角形

通过一系列的户主变换，我们可以变换任意矩阵a∈rm×n，m≥n，

，

其中r为上三角，q∈r m×m为正交。使用小尺寸矩阵可以方便地说明该过程。设A∈R5×4。在第一步中，我们将第一列中主对角线以下的元素归零，

，

其中，+表示在转换中发生变化的元素。正交矩阵h1等于户主变换。在第二步中，我们使用嵌入的户主转换，如（4.3）所示，将元素归零。

四十七


 

在第二列主对角线下方：

.

同样，在右侧，+'表示在转换过程中已更改的元素，+'表示在当前转换过程中未更改的元素。

在第三步中，我们将第三列对角线下的元素湮灭。-

Un:

.

在第四步之后，我们计算了上三角矩阵r，总结了变换序列。

.

注意，矩阵hi具有以下结构（这里假设a∈rm×n）：

（5.1）

，

因此，我们在身份矩阵中嵌入了连续较小维的户主变换，并且在每个步骤中向量ui都变短了。很容易看出矩阵hi也是户主变换。例如，

.

三角形式的变换等价于矩阵A的分解。

5.1正交变换为三角形

定理5.1（qr分解）。任何矩阵a∈rm×n，m≥n都可以用正交矩阵变换成上三角形式。这个变换等价于一个分解

，

其中q∈r m×m为正交，r∈r n×n为上三角。如果a的列是线性无关的，那么r是非奇异的。

证据。前面例子中概述的构造过程可以很容易地适应一般情况，前提是，如果要转换为单位矢量的矢量是零矢量，那么正交变换的选择等于恒等式。

柱的线性独立性

​                                                  

根据提案2.4。由于r是上三角形，线性独立性意味着它的对角元素不是零。（如果一列的对角线上有一个零，那么它将是它左边那些的线性组合。）因此，r的行列式是非零的，这意味着r是非奇异的。

我们在图5.1中象征性地说明了QR分解。

| *A*               =               *Q* | 0                                                                                                                                 *R* |
| ------------------------------------- | ------------------------------------------------------------ |
|                                       |                                                              |

m×n m×m×n

图5.1.QR分解的符号说明。

通常，以另一种方式编写分解是很方便的，其中保留的q的唯一部分对应于a列的正交化；见图5.2。

这种薄的qr分解可以通过划分q=（q1 q2），其中q1∈rm×n，并注意在乘法中，块q2乘以零：

（5.2）

| *A*               =               *Q*1 | *R*  |
| -------------------------------------- | ---- |
|                                        |      |

m×n m×n×n

图5.2.薄qr分解a=q1r。

从这个方程可以看出，r（a）=r（q1）；因此，我们现在已经计算了距离空间r（a）的正交基。此外，如果我们在（5.2）中写出j列，

，

我们看到R中的J列在正交基础上保持AJ的坐标。

例5.2。我们在matlab中对qr分解的计算进行了简单的数值说明：

A=1 1 1 2 4

1 3 3

1 4 4

\>>[Q，R]=QR（A）

| Q=-0.5000 | 0.6708   0.5000   | 零点二二三六 |
| --------- | ----------------- | ------------ |
| -0.5000元 | 0.2236-0.5000     | -0.6708个    |
| -0.5000元 | -0.2236-0.5000    | 零点六七零八 |
| -0.5000元 | -0.6708   0.5000  | -0.2236个    |
| R=-2.0000 | -5.0000至15.0000  |              |
| 零        | -2.2361-11.1803年 |              |
| 零        | 0.2万             |              |
| 零        | 0 0               |              |

通过命令qr（a，0）获得薄qr分解：

\>>[Q，R]=QR（A，0）

Q   =-0.5000 0.6708 0.5000-0.5000 0.2236-0.5000-0.5000-0.2236-0.5000

-0.5000-0.6708 0.5000

5.2.求解最小二乘问题

R    =-2.0000-5.0000-15.0000 0-2.2361-11.1803

0 0 2.0000

5.2求解最小二乘问题

利用QR分解，我们可以解决最小二乘问题。

，（5.3）

式中a∈rm×n，m≥n，不形成正规方程。为此，我们利用欧几里得向量范数在正交变换下不变的事实（命题4.8）：

.

在残差向量中引入A的二维分解，得到

.

然后我们对q=（q1 q2），其中q1∈rm×n，并表示

.

现在我们可以写信了

（5.4）

假设A的列是线性无关的，我们可以求解

Rx=b1

使（5.4）中的第一项等于零，从而最小化。我们现在已经证明了以下定理。

定理5.3（QR分解的最小二乘解）。假设矩阵A∈Rm×N具有全列秩和薄qr分解a=q1r，则最小二乘问题具有唯一解。

   

例5.4.作为一个例子，我们从第3.6节开始解决最小二乘问题。矩阵和右手边是

| A＝1 | 1   B=7.9700  |
| ---- | ------------- |
| 一   | 2000年10月2日 |
| 一   | 3.14.2000年   |
| 一   | 4   16.0000元 |
| 一   | 2000年5月21日 |

具有二维分解和最小二乘解

\>>[q1，r]=qr（a，0）%薄qr

| 问题1=-0.4472 | -0.6325个    |
| ------------- | ------------ |
| -0.4472个     | -0.3162个    |
| -0.4472个     | 零           |
| -0.4472个     | 零点三一六二 |
| -0.4472个     | 零点六三二五 |
| R=-2.2361     | -6.7082个    |
| 零            | 三点一六二三 |

\>>x=r\（q1'*b）

X=4.2360

三点二二六零

注意，matlab语句x=a\b使用完全相同的算法给出了相同的结果。

5.3计算与否Q

通过将变换应用于单位矩阵，可以同时计算正交矩阵q和r。同样，薄qr分解中的q1可以通过将变换应用于部分恒等矩阵来计算。

.

然而，在许多情况下，我们不需要明确的Q。相反，应用相同的户主转换序列可能就足够了。由于（5.1）中所示的嵌入式户主矩阵的结构，用于构造户主转换的向量（将矩阵A简化为上三角形式）可以存储在主对角线下的a中，位置等于零。然后需要一个额外的向量来存储r对角线上的元素。

在求解最小二乘问题（5.3）时，根本不需要计算q。通过将右侧连接到矩阵，我们计算

，

5.4.QR因子分解的失败计数

通过求解得到最小二乘解。我们也看到了

.

因此，最优残差范数是作为三角化过程的副产品得到的。

5.4 QR因子分解的失败计数

如第4.3节所示，将户主转换应用于m×n矩阵，使对角线下第一列的元素归零，需要大约4mn的浮点运算。在下面的转换中，只有行2到m和列2到n发生了更改（请参见（5.1）），并且受转换影响的子矩阵的维数在每个步骤中都减少了一个。因此，用于计算r的触发器的数量大约是

.

然后矩阵Q以因子形式提供，作为户主转换的产物。如果我们显式地计算全矩阵q，那么在步骤k+1中我们需要

4（m−k）m触发器，总共导致

.

可以利用q累积中的结构来稍微减少触发器计数[42，第5.1.6节]。

5.5最小二乘问题解的误差

如第4.4节所述，户主转换和平面旋转在浮点舍入误差方面具有良好的特性。这里我们给出一个定理，其证明可在[50，定理19.3]中找到。

定理5.5。假设a∈rm×n，m≥n具有全列秩，并通过户主变换用qr因子分解法求解最小二乘问题。那么计算出的解x_是

，

哪里

，

c1和c2是小常数。

由此可见，从向后误差的意义上来说，该解是尽可能好的（即，该方法是向后稳定的）。利用第6.6节中的摄动理论，可以估计计算解中的正向误差。在第3.6节中，我们建议用于求解最小二乘问题的法方程法在浮点运算中具有不太令人满意的特性。结果表明，除非矩阵A条件良好，否则该方法是不可逆稳定的。这两种方法的优缺点在[50，p.399]中得到了很好的总结。这里我们给出一个例子，尽管有些极端，但证明对于某些最小二乘问题，用正态方程法给出的解比用qr分解得到的解要精确得多；参见例3.12。

例5.6。让我们来考虑矩阵

.

A的条件编号为107号命令。以下matlab脚本

x=[1；1]；b=a*x；

xq=a\b；%qr分解xn=（a'*a）\（a'*b）；%正态方程

[XQ XN]号

给出了结果

1.0000000000000 1.01123595505618

1.0000000000000 0.98876404494382，说明正态方程法存在矩阵ata的条件数是a的条件数的平方这一事实。

5.6更新最小二乘法的解

问题

在某些应用中，A的行和B的相应元素是实时测量的。让我们把B的元素称为观察。每次观测到，都要计算一个新的最小二乘解。如果我们从头开始重新计算这个解决方案，每一次新的观察都会花费O（mn2）触发器。这在大多数情况下都太昂贵了，而且计算量也不必要太大，因为每次有新的观测结果时，可以通过更新o（n2）触发器中的qr分解来计算最小二乘解。此外，更新算法不要求我们保存正交矩阵Q！

假设我们已经减少了矩阵和右手边

，（5.5）

5.6.更新最小二乘问题的解决方案

​             

从中可以很容易地得到最小二乘解。假设我们没有

标量。然后，我们要找到增广最小二乘问题的解，然后用一个新的观察值来表示（在β），其中a∈rn和β是a。

（5.6）

对于新的矩阵，我们可以将约简式（5.5）写成

.

因此，如果我们减少，我们可以找到增广最小二乘问题（5.6）的解。

   

通过一系列正交变换形成三角形。矢量在这个约简中不起作用，因此我们从推导中排除它。

现在我们将演示如何使用平面旋转序列将其还原为三角形。算法的思想将用一个n=4的小例子来说明。我们从

.

通过在（1，n+1）平面上的旋转，我们将底行向量的第一个元素归零。结果是

++++++×+×+×+

×××，

××

0××

其中，+表示在当前转换中已更改的元素。然后，底部向量的第二个元素通过（2，n+1）中的旋转归零：

_

×××。

××

0××

请注意，上一步中引入的零不会被销毁。经过三个类似的步骤，最终结果是：

.

总共需要n个旋转来计算减少量。（5.6）的最小二乘解现在通过求解rx∙∙b1得到。


 